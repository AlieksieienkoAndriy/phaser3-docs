<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Percy Doc Thrower</title>
        <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
        <script src="./lib/getQueryString.js"></script>
        <script src="./lib/sql.js"></script>
    </head>
    <body>

        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <a class="navbar-brand" href="index.html">Percy</a>
            <div class="navbar-nav">
                <a class="nav-item nav-link" href="class.html">Class</a>
                <a class="nav-item nav-link" href="function.html">Function</a>
            </div>
        </nav>

        <div class="container-fluid">
            <div class="row">
                <div class="col" id="list"></div>
            </div>
        </div>

        <script type="text/javascript">

        function addFolder (folder)
        {
            var list = $('#list');

            var name = $('<h5>').text(folder.name);

            list.append(name);

            if (folder.type === 'directory')
            {
                addFiles(folder.children);
            }
        }

        function addFiles (files)
        {
            for (var i = 0; i < files.length; i++)
            {
                var file = files[i];

                if (file.type === 'directory')
                {
                    addFolder(file);
                }
                else
                {
                    var list = $('#list');

                    if (file.name !== 'index.js' && file.extension === '.js')
                    {
                        var url = file.path;

                        var p = $('<div>', { style: 'font-size: 14px' }).text(file.name);
                        var a1 = $('<a>', { class: 'ml-4', href: 'function.html?f=' + url }).text('function');
                        var a2 = $('<a>', { class: 'ml-4', href: 'class.html?f=' + url }).text('class');

                        list.append(p.append(a1, a2));
                    }
                }
            }
        }

        function renderContents (files)
        {
            var list = $('#list');

            for (var i = 0; i < files.length; i++)
            {
                var entry = files[i];
                var filename = entry[0];
                var done = (entry[1] === 1);
                var url = filename;

                var p = $('<div>', { style: 'font-size: 14px' }).text(filename);
                var a1 = $('<a>', { class: 'ml-4', href: 'function.html?f=' + url }).text('function');
                var a2 = $('<a>', { class: 'ml-4', href: 'class.html?f=' + url }).text('class');

                list.append(p.append(a1, a2));
            }
        }

        $(document).ready(function () {

            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/phaser3-docs/percy/converted.db', true);
            xhr.responseType = 'arraybuffer';

            xhr.onload = function (e)
            {
                var uInt8Array = new Uint8Array(this.response);
                var db = new SQL.Database(uInt8Array);
                var contents = db.exec("SELECT * FROM files");

                // console.log(contents[0].values);

                renderContents(contents[0].values);
            };

            xhr.send();

            /*
            $.getJSON('files.json', function (json) {

                for (var i = 0; i < json.children.length; i++)
                {
                    var folder = json.children[i];

                    if (folder.type === 'directory')
                    {
                        addFolder(folder);
                    }
                }

            });
            */

        });

        </script>

    </body>
</html>