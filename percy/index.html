<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Percy Doc Thrower</title>
        <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
        <script src="./lib/getQueryString.js"></script>
        <script src="./lib/sql.js"></script>
    </head>
    <body>

        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <a class="navbar-brand" href="index.html">Percy</a>
            <div class="navbar-nav">
                <a class="nav-item nav-link" href="index.html">All</a>
                <a class="nav-item nav-link" href="index.html?show=1">Done</a>
                <a class="nav-item nav-link" href="index.html?show=0">Remaining</a>
            </div>
        </nav>

        <div class="container-fluid">

            <div class="progress mt-4">
                <div id="progressBar" class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="height: 24px; color: black; font-size: 16px; font-weight: bold; line-height: 24px">0%</div>
            </div>

            <div class="button-group my-4" id="buttonList"></div>

            <ul class="list-group my-4" id="list"></ul>

        </div>

        <script type="text/javascript">

        function renderContents (files)
        {
            var list = $('#list');

            for (var i = 0; i < files.length; i++)
            {
                var entry = files[i];
                var filename = entry[0];

                if (filename.indexOf('index.js') !== -1)
                {
                    continue;
                }

                var done = (entry[1] === 1) ? 'list-group-item list-group-item-success' : 'list-group-item';

                var li = $('<li>', { class: done, style: 'font-family: Consolas; font-size: 14px' }).text(filename);
                var a1 = $('<a>', { href: 'function.html?f=' + filename, class: 'badge badge-primary mx-4' }).text('Function');
                var a2 = $('<a>', { href: 'class.html?f=' + filename, class: 'badge badge-warning' }).text('Class');

                list.append(li.append(a1, a2));
            }
        }

        $(document).ready(function () {

            //  Top-level buttons

            var buttons = [
                'actions',
                'animation',
                'boot',
                'cache',
                'camera',
                'canvas',
                'create',
                'device',
                'dom',
                'events',
                'gameobjects',
                'geom',
                'graphics',
                'input',
                'loader',
                'math',
                'paths',
                'physics',
                'renderer',
                'scene',
                'sound',
                'structs',
                'textures',
                'time',
                'tween',
                'utils'
            ];

            var buttonList = $('#buttonList');
            var filter = getQueryString('filter');

            for (var i = 0; i < buttons.length; i++)
            {
                var name = buttons[i];
                var css = (name === filter) ? 'btn btn-danger btn-sm mx-1 my-1' : 'btn btn-primary btn-sm mx-1 my-1';

                var a = $('<a>', { class: css, href: 'index.html?filter=' + name, role: 'button' }).text(name);

                buttonList.append(a);
            }

            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/phaser3-docs/percy/converted.db', true);
            xhr.responseType = 'arraybuffer';

            xhr.onload = function (e)
            {
                var uInt8Array = new Uint8Array(this.response);
                var db = new SQL.Database(uInt8Array);

                var result;
       
                //  Totals
                result = db.exec("SELECT COUNT(*) FROM files");

                var total = result[0].values[0][0];

                result = db.exec("SELECT COUNT(*) FROM files WHERE done=1");

                var done = result[0].values[0][0];

                var progress = Math.round(total / done);

                console.log(total, done, progress);

                $('#progressBar').css('width', progress + '%').text(progress + '%');

                if (filter !== '')
                {
                    result = db.exec("SELECT path,done FROM files WHERE path LIKE '" + filter + "%'");
                }
                else
                {
                    var show = getQueryString('show');

                    if (show === '0')
                    {
                        result = db.exec("SELECT path,done FROM files WHERE done=0");
                    }
                    else if (show === '1')
                    {
                        result = db.exec("SELECT path,done FROM files WHERE done=1");
                    }
                    else
                    {
                        result = db.exec("SELECT path,done FROM files");
                    }
                }

                renderContents(result[0].values);
            };

            xhr.send();

        });

        </script>

    </body>
</html>